<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Art Weaver AI{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        tailwind.config = { darkMode: 'class' };
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; display: flex; flex-direction: column; min-height: 100vh; }
        main { flex-grow: 1; }
        .loader { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        .dark .loader { border-top-color: #60a5fa; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <nav class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="{{ url_for('home') }}" class="flex items-center space-x-3">
                <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Art Weaver AI Logo" class="h-10 w-10 rounded-full">
                <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">Art Weaver AI</span>
            </a>
            <div id="nav-right-section" class="flex items-center space-x-6">
                <div id="user-info-nav" class="hidden items-center space-x-4">
                    <a href="{{ url_for('dashboard') }}" class="text-gray-600 dark:text-gray-300 hover:text-blue-500">Dashboard</a>
                    <a href="{{ url_for('explore') }}" class="text-gray-600 dark:text-gray-300 hover:text-blue-500">Explore</a>
                    <a href="{{ url_for('messages_page') }}" class="text-gray-600 dark:text-gray-300 hover:text-blue-500">Messages</a>
                    <div class="relative" id="notifications-container">
                        <button id="notification-bell-btn" class="relative p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                            <span id="notification-badge" class="absolute top-0 right-0 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden"></span>
                        </button>
                        <div id="notification-dropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden z-10 hidden">
                            <div class="p-4 font-bold border-b dark:border-gray-700">Friend Requests</div>
                            <div id="friend-requests-list" class="max-h-96 overflow-y-auto"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 border-l border-gray-300 dark:border-gray-600 pl-4">
                        <a href="{{ url_for('profile') }}" id="nav-username" class="font-semibold hover:text-blue-500"></a>
                        <span id="nav-points" class="text-sm bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300 px-3 py-1 rounded-full"></span>
                        <button id="logout-btn" class="bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600 text-sm">Logout</button>
                    </div>
                </div>
                <div id="guest-nav" class="flex items-center space-x-4">
                    <a href="{{ url_for('explore') }}" class="text-gray-600 dark:text-gray-300 hover:text-blue-500">Explore</a>
                    <a href="{{ url_for('login') }}" id="get-started-btn" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">Get Started</a>
                </div>
            </div>
        </div>
    </nav>
    <main class="container mx-auto p-4 md:p-6">
        {% block content %}{% endblock %}
    </main>
    <footer class="mt-auto p-6 text-sm text-gray-500 dark:text-gray-400">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                 <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"></button>
                 <span id="location-display" class="text-xs"></span>
            </div>
             <div class="text-right">
                <div class="flex justify-end items-center space-x-4">
                    <a href="mailto:210401@iitk.ac.in" class="hover:text-blue-500" aria-label="Email"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a>
                    <a href="https://github.com/prajwal-pp7/Art-Weaver-AI" target="_blank" rel="noopener noreferrer" class="hover:text-blue-500" aria-label="GitHub"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.942.359.308.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0020 10c0-5.523-4.477-10-10-10z" clip-rule="evenodd"></path></svg></a>
                </div>
                <p class="mt-2">IIT Kanpur</p>
            </div>
        </div>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script>
        async function initializeFirebaseAndLoadScripts() {
            try {
                const response = await fetch('/api/firebase-config');
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }
                const config = await response.json();

                if (!config.apiKey) {
                    throw new Error("Invalid Firebase configuration received from server.");
                }

                firebase.initializeApp(config);

                const mainScript = document.createElement('script');
                mainScript.src = "{{ url_for('static', filename='js/main.js') }}";
                document.body.appendChild(mainScript);

                {% if request.endpoint in ['login', 'register'] %}
                const authScript = document.createElement('script');
                authScript.src = "{{ url_for('static', filename='js/auth.js') }}";
                document.body.appendChild(authScript);
                {% endif %}

            } catch (error) {
                console.error("CRITICAL: Failed to initialize Firebase.", error);
                const mainContent = document.querySelector('main');
                if(mainContent) {
                    mainContent.innerHTML = `<div style="text-align: center; padding: 50px; color: red;"><h1>Application Configuration Error</h1><p>Could not load application configuration from the server. Please ensure the backend is running and environment variables are set correctly.</p><p style="margin-top: 10px; font-family: monospace; background: #eee; padding: 10px; border-radius: 5px; color: #333;">Error: ${error.message}</p></div>`;
                }
            }
        }
        document.addEventListener('DOMContentLoaded', initializeFirebaseAndLoadScripts);
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>